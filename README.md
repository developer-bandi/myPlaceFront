# MyPlace

<p>사용기술 : next-js, redux,redux-toolkit, redux-saga, scss,typescript, jest, testing-library</p>
<p style="margin:0 0 20px 0;">웹사이트 : <a href="https://movieinfoservice.netlify.app/">https://my-place-front-eosin.vercel.app</a></p>
<p>(네이버 소셜 로그인은 관리자만 사용가능하며 서버가 sleep 상태 이므로 30초정도를 기다려야합니다)</p>

## 1.프로젝트 소개

장소를 찾기 위해서 구글링, 네이버 검색을 해본경험이 있을것 입니다. 보통은 한가지 키워드를 가지고 검색을 하지만, 다양한 키워드를 가지고 장소를 찾을때가 있습니다. 가령 연인끼리 가기 좋은 카페인데, 당근케이크와 딸기 케이크가 맛있으며, 오션뷰가 있는 곳 같은 경우입니다. 이런 공간을 쉽게 찾을수 있도록 키워드 기반의 장소 검색을 서비스 하는 프로젝트입니다

## 2.주요 기능 소개

### 로그인

유저 로그인은 네이버/카카오 소셜로그인과 로컬로그인 두가지중 한가지로 수행할수 있습니다.

로컬로그인의 경우 아이디를 찾거나 비밀번호를 재설정 할수있는데, 이는 회원가입시 입력한 이메일에 전달된 난수번호를 입력함으로써 수행할수 있습니다.

### 장소 검색

장소검색은 태그 검색과 키워드 검색 두가지가 가능합니다. 태그 검색의 경우, 태그를 선택하여 검색하며, 키워드 검색은 장소이름을 직접 입력하여 검색하게 됩니다.

검색절차는, 기준위치를 결정한후, 태그 혹은 키워드를 입력하고 검색을 누르면, 기준위치에서 가까운 순서대로 장소가 결과창에 나오게됩니다.

그중 관심있는 장소를 누르게되면 장소에 대하여 주소, 영업시간 전화번호 메뉴판 후기 등 더 자세한 정보를 볼수 있으며, 경우에따라 후기를 남기거나, 해당정보를 수정해 기여하거나, 해당장소를 북마크 할수 있습니다

### 장소 등록/수정하기

기여하기 탭을 통해 장소를 등록하거나 혹은 장소검색을 통해 볼수있는 장소 세부탭에서 장소에 대한 정보를 수정할수 있습니다.

후기의 경우는 기여하기 탭을 통하여 진입할수는있으나, 장소 검색을 통해서만 등록할수있고 후기를 수정하기 위해서는 개인 페이지에서 수정할수 있습니다.

### 커뮤니티

커뮤니티 리스트에서는 포스트를 정렬 조건에 맞추어 정렬할수 있고, 키워드를 입력하여 검색할수 있습니다. 검색후에도, 정렬을 사용하면 검색된 값을 기준으로 정렬합니다.

커뮤니티 리스트에서 글을 하나 클릭하여 상세 페이지로 들어가게 되면, 댓글을 달거나 좋아요를 표시할수 있습니다. 좋아요를 표시하게되면 작성자에게, 댓글을 달면 작성자와 댓글 작성자에게 알림이 가게 됩니다.

커뮤니티 리스트를 통해 글을 작성할수도 있습니다. 글쓰기 버튼을 통해서 이동할수 있으며, 글, 제목 간단한 사진을 업로드 할수 있도록 되어있습니다.

### 마이페이지

북마크,자신이 작성한 후기,포스트,댓글 을 볼수 있으며 개인정보를 수정하거나 회원탈퇴를 진행할수 있습니다.

## 3. 사용 기술 상세

### 폴더 구조

컴포넌트의 폴더구조는 도메인을 기준으로 나누었습니다. 한 컴포넌트 내에는 훅, 프레젠테이션,컨테이너, 테스트,스타일 총5개가 기본적으로 포함되며 경우에따라 스타일이 공통스타일로 관리되면 없을수 있고, 비즈니스 로직이 없다면 훅가 컨테이너가 없을수있습니다.

훅에는 해당 프레젠테이션에서 사용되는 비즈니스 로직이 들어가며 컨테이너에서는 훅의 로직뿐만 아니라 커스텀 훅의 로직을 받는 공간입니다.

사실 많은 컴포넌트에서 커스텀훅을 받지않고, 훅 한개만을 받아 사용하는데, 이럴경우 컨테이너는 단순히 전달하는 역할이라서, 프레젠테이션에서 훅을 바로 사용해도 문제가 없을수 있습니다. 하지만 저는 props로 받아 타입을 선언하는것이 컴포넌트에대한 설명을 해줄수 있다고 생각하였기에, 이러한 폴더구조를 유지하였습니다.

### ssg / isr / ssr / csr

next js 에서는 ssg, isr ssr 순서로 채택하도록 권하고있기에, 이를 반영하여 기준을 구성하였습니다.

- ssg : 빌드이후 변화가 생기지 않는 경우 선택하는데, 해시태그의 목록같은경우가 이에 해당한다.
- isr: 빌드이후 자주 변화가 생가지 않는 경우 선택하는데, 홈의 배너와, 장소 순위목록이 이에 해당한다. 변경되는 시간을 명시해 줌으로써 유저에게 변화가 진행중이라는 느낌을 줄수도 있다.
- ssr: 빌드이후 자주 수정되면서 seo가 필요한 영역에 적용한다. 예를 들면 포스트 정보가 이에 해당한다
- csr: 빌드이후 자주 수정되지만 seo가 필요없는 영역에 적용한다. nextjs 공식홈페이지에서도 권장하듯이 마이페이지같은경우가 대표적으로 이에 해당하고, 이외에 장소 정보를 찾는 페이지도 seo가 무조건 필요하다고 생각하지는 않아서 csr로 렌더링 하였다.

### 상태관리(redux,redux-saga)

상태관리는 생태계가 크고 여전히 많이 사용되고 있는 redux와 redux-saga를 사용하였습니다. 최근에는 redux-saga대신 api를 react-query로 관리하는 경우가 늘고 있지만, 해당 프로젝트에서 캐싱이 필요한 api가 많지 않고, api를 호출하는 보일러플레이트를 커스텀 훅으로 관리하여 어느정도 단점을 잡았다고 생각하고 개인적으로 redux-saga의 구조에 불편함이 없기에 사용하였습니다.

redux와 함께 redux-toolkit을 사용하였습니다. 기능적인 이점이 있지는 않지만 redux의 단점인 보일러플레이트 코드를 많이 줄여주기 때문입니다.

redux-saga로 불러오는 정보는 캐싱이 필요한 정보에 한해서 사용하였습니다. 이외의 api는 호출이 필요한 컴포넌트에서 호출하였습니다. 또한 이후 유지보수에 지장이 있을것 같아 redux의 한개의 리듀서에 너무많은 정보를 포함하지 않도록 노력하였습니다.

### 반응형(react-responsive,scss)

구조가 변경되어야 하는경우 react-responsive라이브러리를 사용하여, 화면의 크기에 따라 컴포넌트가 어떻게 구성되는지를 결정하였고, 단순히 비율을 조정하는 정도라면 css를 활용하였습니다. 이과정에서 가장 요긴하게 사용된 것은 vh,vw와같이 뷰포트를 기준으로 결정되는 단위와 다양한 단위들을 혼합하여 계산할수 있게 해주는 calc이라는 함수였습니다. 이러한 함수를 이용하여 뷰포트의 높이가 높아서 footer이하가 잘려 다소 좋지 않은 모습을 보여주는 경우에, footer가 맨 하단에 붙도록 할수 있었습니다.

또한 북마크의 경우, 4개이상이 존재할경우, 사이즈에 따라 3,2 개로 줄어드는데, 이과정에서 이미지 사이즈를 유지하면서 커졌다가 작아지는 과정을 반복하는데, 이또한 반응형을 고려하였습니다.

### 테스트(jest,react-testinglibrary)

테스트는 크게 프레젠테이션컴포넌트와, 훅, 그리고 리덕스와 사가 코드로 나눌수 있습니다. 프레젠테이션 코드는 storybook을 이용해서 시각적으로 테스트하였고, 훅은 useEffect가 있다면 해당 테스트와, 함수의 작동이 잘 되는지를 체크하였습니다. 리덕스의 경우 리듀서함수가 잘 작동하는지를 체크하였고, 사가의 경우에도 saga-test-plain라이브러리를 이용하여, 가짜로 액션을 발생시킨뒤에 해당 사가가 발생하는지를 테스트 하였습니다.

카카오 맵의 경우 함수가 복잡하여 mocking하는데 어려움이 많았던것 같습니다. 이러한 이유때문에 너무 복잡한 mocking 이필요한경우 테스트를 하지 못했습니다.

### 성능 체크 (lighthouse)

lighthouse를 이용하여 성능 테스트를 간단하게 진행하였습니다. 대부분의 페이지에 적용하였고, 간단한 수정으로 점수가 많이 상승하였습니다.

- image/next 태그를 통해 화면에 보이지 않은 요소는 미리 렌더링하지 않고, 가능한경우, 웹 친화적인 확장자로 변경해주는 점을 이용하고, 서버로부터 이미지를 작게 가져오는 방법을 사용하여 이미지 최적화하였음 . 대부분의 지표가 긍정적으로 변경(home page)
- document 페이지를 이용하여 언어설정
- aria label을 이용하여 버튼 혹은 인풋에 관련 정보가 없을경우 대체 정보를 삽입
- h태그가 순차적으로 구성되어있지 않은경우, 이를 순차적으로 구성

### 배포 및 이슈관리

프론트 배포는 vercel로 하였으며 깃허브와 연동하여 자동으로 배포가 될수 있도록 구성하였습니다. 또한 배포 이후에는 문제가 발생하면 이슈를 등록하고 이슈 단위로 커밋을 진행하였습니다.

### 타입 스크립트

redux와 타입스크립트를 사용하였을때, useSelector로 스토어의 값을 가져오고자 할때, 오타를 발생시키는 실수를 하지 않는것 처럼, api등의 객체 프로퍼티를 사용할때, 실수를 할 가능성이 굉장히 줄어들고, 자동완성이 쉽기 때문에, 시간도 단축된다고 생각합니다.

또한 리액트 컴포넌트에서 props를 받아오는데, 사실 이름만가지고 이것이 어떠한 역할을 하는지 알기 쉽지 않습니다. 리액트에서 지원하는 propsTypes 처럼 props들이 대략적으로 어떤 기능을 갖는지 알수 있는 문서 역할을 할수 있다고 생각합니다.

## 4.트러블 슈팅

### image 사이즈 조정

홈 화면일때 브라우저의 다른 탭을 갔다가오면 1초정도 화면이 모두 하얗게 변하는 현상이 있었습니다. 다른 페이지에서는 발생하지 않았기에 다른 페이지와 차이점을 고민해보니 홈화면에는 사진이 다수 들어가 있었고, 해당 사진이 들어있는 컴포넌트를 삭제하자 정상적으로 렌더링되는것을 보고 사진에서 문제가 발생함을 인지하였습니다.

하지만 정확하게 어떤 문제인지는 알수 없었는데, lighthouse를 사용하면서 알게 되었습니다. 받아오는 사진크기가 해당 화면의 크기보다 훨씬커서 나타나는 문제였습니다. 사진을 제공받는 사이트에서 미리 사진크기를 정할수 있었기에, 기존의 사진용량의 1퍼센트만 받아오도록 수정하였고, 위의 문제가 더이상 발생하지 않았습니다.

### 반응형 calc 함수

데스크탑 같이 세로가 긴 경우에는 특정 페이지에서 footer 아래에 빈 여백이 생기는 상황이 있었습니다. 이는 메인 화면이 footer와 header에서 뷰포트를 뺀만큼을 차지하도록 구성해야하는데, 중요한것은 기존에 사이즈를 표기하는 방식으로는 해결할수 없었습니다.

결국 구글링을 하다가 우연히 css에서 사이즈를 계산하여 넣는 함수가 있다는 사실을 알게되었고 이를 적용하여 간단하게 해결할수 있었습니다.

### useRef 테스트

컴포넌트의 hook 을 테스트할때 useRef에서 문제가 자주 발생하였습니다. 해당 useRef는 ref에 할당되지 않아서 값을 가질수 없기 때문에 mockimg을 해주어야 했습니다. spyon함수의 mockReturnValue를 사용하여 일괄로 mocking하는 경우 큰 문제가 없었으나, mockReturnValueOnce를 사용한 경우 mocking이 되지 않았습니다.

컴포넌트와 테스트 코드에 log을 찍어가면서 해당 상황이 테스트코드를 실행할때 useRef가 두번 실행되는것과 유사하게 되어서 값이 아예 mocking이 되지 않는것이어서 mockReturnValueOnce를 사용하는경우 useRef갯수의 두배만큼을 실행해서 사용하였습니다.
